---
layout: post
title:  第十三期
---



从[reddit](https://www.reddit.com/r/cpp/)/[hackernews](https://news.ycombinator.com/)/[lobsters](https://lobste.rs/)/[meetingcpp](https://www.meetingcpp.com/blog/blogroll/)摘抄一些c++动态。

每周更新

周刊项目地址 [github](https://github.com/wanghenshui/cppweeklynews)，[在线地址](https://wanghenshui.github.io/cppweeklynews/) | [discord讨论群组](https://discord.gg/cZ9mXVPGx6) ｜[飞书讨论群组](https://applink.feishu.cn/TeeBWN1D)｜[知乎专栏](https://www.zhihu.com/column/jieyaren)

欢迎投稿，推荐或自荐文章/软件/资源等，请[提交 issue](https://github.com/wanghenshui/cppweeklynews/issues)

---

## 资讯

###  编译器信息最新动态推荐关注hellogcc公众号

[本周周报github直达](https://github.com/hellogcc/osdt-weekly/blob/master/weekly/2021-05-12.md)

- zstd 1.5发布，性能提升巨大 https://github.com/facebook/zstd/releases/tag/v1.5.0

## 文章

- [GCC 的整体架构](https://zhuanlan.zhihu.com/p/372526494) 介绍了gcc的架构以及处理流程，值得一看，拓展眼界

- [Practical Design Patterns: Opaque Pointers and Objects in C](https://interrupt.memfault.com/blog/opaque-pointers)

  看代码

  Ringbuffer.h

  ```c++
  #pragma once
  
  #include <stdint.h>
  #include <stdbool.h>
  
  // Opaque pointer type to represent a ringbuffer instance
  // 作者管这个叫opaque pointer
  typedef struct ringbuffer_instance_t* ringbuffer_t;
  
  // Functions that operate on an instance
  ringbuffer_t ringbuffer_create(uint32_t capacity);
  uint32_t ringbuffer_capacity(ringbuffer_t instance);
  bool ringbuffer_enqueue(ringbuffer_t instance, uint8_t item);
  bool ringbuffer_dequeue(ringbuffer_t instance, uint8_t* item);
  void ringbuffer_destroy(ringbuffer_t instance);
  
  ```

  ringbuffer.c

  ```c++
  #include "ringbuffer.h"
  #include <stdlib.h>
  
  // Private struct, only accessible from within this file
  struct ringbuffer_instance_t {
      volatile uint32_t wr_pos;
      volatile uint32_t rd_pos;
      uint8_t* data;
      uint32_t capacity;
  };
  
  ringbuffer_t ringbuffer_create(uint32_t capacity) {
      ringbuffer_t inst = calloc(1, sizeof(struct ringbuffer_instance_t));
      inst->data = calloc(capacity, sizeof(uint8_t));
      inst->capacity = capacity;
      inst->wr_pos = 0;
      inst->rd_pos = 0;
      return inst;
  }
  
  uint32_t ringbuffer_capacity(ringbuffer_t instance) {
      return instance->capacity;
  }
  
  bool ringbuffer_enqueue(ringbuffer_t instance, uint8_t item) {
      // implementation omitted
      return true;
  }
  
  bool ringbuffer_dequeue(ringbuffer_t instance, uint8_t* item) {
      // implementation omitted
      return true;
  }
  
  void ringbuffer_destroy(ringbuffer_t instance) {
      if (instance) {
          if (instance->data) {
              free(instance->data);
          }
          free(instance);
      }
  }
  ```

   作者管这个ringbuffer_t叫opaque pointer实际上就是一层不透明封装，当handle用。这个不是什么新的技巧了

- [Ambiguity in template parameters](https://brevzin.github.io/c++/2021/05/12/template-ambiguity/)

  讨论了一下模版NTTP和其他类型和concept一锅烩等场景，看个乐

- [Porting Intel Intrinsics to Arm Neon Intrinsics](https://www.codeproject.com/Articles/5301747/Porting-Intel-Intrinsics-to-Arm-Neon-Intrinsics) 

  手把手教你写sse移植代码(从x86到arm)

-   [c++ tip of week 226 **Did you know about C++23 feature which adds support for inheriting from std::variant?**](https://github.com/QuantlabFinancial/cpp_tip_of_the_week/blob/master/226.md)

std::variant支持继承，再实现operator()更方便std::visit 在线演示[godbolt](https://godbolt.org/z/oez6McKzn)

```c++
struct value : std::variant<int, double> {
  using variant::variant;

  constexpr auto operator()(const auto& value) {
    std::clog << value << '\n';
  }
};

int main(){
  std::visit(value{}, std::variant<int, double>(42));  // prints 42
  std::visit(value{}, std::variant<int, double>(99.)); // prints 99
}
```



## 视频

- [C++ Weekly - Ep 271 - string.clear() vs string = ""](https://www.youtube.com/watch?v=3X9qK7HWxjk)

benchmark显示clear要比赋值快很多很多, 主要是赋值造成的开销

<iframe width="560" height="315" src="https://www.youtube.com/embed/3X9qK7HWxjk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>



## 项目

- 


---

看到这里或许你有建议或者疑问或者指出错误，请留言评论! 多谢!  你的评论非常重要！也可以帮忙点赞分享转发！多谢支持！

